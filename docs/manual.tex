\documentclass[12pt]{report}
\usepackage[utf8]{inputenc}
\usepackage{siunitx}
\usepackage{listings}
\usepackage{hyperref}
\hypersetup{
    colorlinks=false,
}

\newcommand{\packagename}[1]{\textit{#1}}
\newcommand{\thispackage}{\packagename{dimensional-dk}}
\newcommand{\experimentalpackage}{\packagename{dimensional-dk-experimental}}
\newcommand{\classname}[1]{\textit{#1}}
\newcommand{\typename}[1]{\textit{#1}}
\newcommand{\modulename}[1]{\textit{#1}}
\newcommand{\submodule}[1]{\modulename{Numeric.Units.Dimensional.DK.{#1}}}

\title{
	{Writing Physical Computations in Haskell with \thispackage}\\
	{\small{Version 1.0}}
}
\author{BjÃ¶rn Buckwalter and Douglas McClean}
\date{\today}

\begin{document}

\maketitle

\tableofcontents

\chapter{Introduction}

The \thispackage{} library provides data types for performing arithmetic with physical
quantities. Information about the physical dimensions of each quantity is embedded in
its type.

This allows the compiler to statically verify that no dimensional mistakes have been
made in a calculation. It also facilitates interconversion between quantities expressed
in different units and provides documentation of dimension and units of each physical
quantity a program manipulates.

\section{Installation}

The latest version of \thispackage{} can be installed in the usual way, using the following commands:

\begin{lstlisting}[language=bash]
cabal update
cabal install dimensional-dk
\end{lstlisting}

Historical versions and Haddock documentation are available at \url{http://hackage.haskell.org/package/dimensional-dk}.

\section{Licensing}

The \thispackage{} package is provided under a BSD 3-clause license.

\section{Contributing}

Contributions to \thispackage{} development, in the form of bug reports,
feature requests, or pull requests, are welcome. The source code repository and issue
tracker are both hosted by GitHub at \url{https://github.com/bjornbm/dimensional-dk}.

\chapter{Dimensional Arithmetic}

\chapter{Manipulating Units}

\section{Unit Names}

\subsection{Interchange Names}
\subsection{Unit Name Normal Forms}

\chapter{Fixed Point Dimensional Arithmetic}

Although floating point arithmetic is fast and convenient for many applications, the \thispackage{} package also provides
support for performing fixed point computations with dimensional values.

Using the \packagename{exact-pi} package's support for type-level positive rationals extended with an exact representation
of $ \pi $, \thispackage{} statically encodes the scale factor between the least significant bit of the chosen \classname{Integral}
representation and the coherent SI unit of the quantity's dimension. This allows fixed point representations to be
treated uniformly and correctly by arithmetic operations without requiring the programmer to appropriately scale the results
before storing them.

The familiar \typename{Quantity} type is an alias for \typename{SQuantity One} (where \typename{One}) is the \packagename{exact-pi}
package's representation of the number 1. While it is possible to use \typename{SQuantity} with other scaling factors and a
floating point or exact rational representation type, it is rarely necessary to do so because the range of common floating
point representations can comfortably encode both very large and very small physical quantities directly represented in the
coherent SI unit of their dimension.

Where \typename{SQuantity} becomes more directly useful, and where special fixed point support is required, is when an
\classname{Integral} representation type is desired. For example, an embedded system may wish to encode the estimated
velocity of a vehicle as a 16-bit signed integer with a minimum increment of \SI{1}{\centi\meter\per\second}. It is common
to represent such a value by a variable of type \typename{Int16} and an accompanying comment or naming convention indicating
the dimension and scale factor, but \thispackage{} provides a more expressive type, which can be written in one of several ways.

Without using Template Haskell, one could write:

\begin{lstlisting}[language=haskell]
import Numeric.Units.Dimensional.FixedPoint.Prelude
import qualified Data.ExactPi.TypeLevel as E
import Data.Int

type VehicleSpeed = SQuantity (E.One E./ (E.ExactNatural 100)) DLength Int16
\end{lstlisting}

With Template Haskell either of the following simpler forms is equivalent to the one given above:

\begin{lstlisting}[language=haskell]
import Numeric.Units.Dimensional.FixedPoint.Prelude
import Numeric.Units.Dimensional.TH
import Data.Int

type VehicleSpeed1 = SQuantity [exact| 1/100] DLength Int16
type VehicleSpeed2 = [fp| cm / s] Int16
\end{lstlisting}

In the latter example, note that both the scale factor and dimension were determined by the type quasiquoter, and so it
only remained to specify the representation type.

TODO: give an example where the scale isn't an exact unit, other examples of accepted syntax for quasiquoter

TODO: give examples of performing arithmetic with such values

The transcendental functions from \modulename{Numeric.Units.Dimensional} have types like:

\begin{lstlisting}[language=haskell]
sin :: Floating a => Dimensionless a -> Dimensionless a
\end{lstlisting}

However when using fixed point values, we wish to use representation types which lack \classname{Floating} instances. Accordingly,
the \modulename{Numeric.Units.Dimensional.FixedPoint} module provides transcendental functions with types like the one given below.
Note that as is often the case in the fixed point module, in order to provide maximal flexibilty and preserve precision of
intermediate results, the result type of the operation is not fully determined by the types of its operand and instead is
determined from context.

\begin{lstlisting}[language=haskell]
sin :: (KnownExactPi s1, KnownExactPi s2 Integral a) => SQuantity s1 DOne a -> SQuantity s2 DOne a
\end{lstlisting}

\chapter{Interoperating with Other Packages}

\section{\packagename{ad} for Automatic Differentiation}
\section{\packagename{attoparsec} for Unit and Quantity Parsing}
\section{\packagename{HaTeX} for \LaTeX{} Generation}
\section{\packagename{ihaskell} for Interactive Notebooks}

The IHaskell project provides support for interactive notebook documents containing
Haskell code through the Jupyter project.

Instances of \classname{IHaskellDisplay} for \typename{Quantity} and \typename{Unit}
allow attractive \LaTeX{}-style display of dimensional values in your notebooks. These
instances can be found in the \submodule{IHaskell} module of the \experimentalpackage{}
package.

\section{\packagename{lens}}

Todo: Without taking a dependency on lens, offer a declaration that can convert a unit into a lens from quantities to numeric values.
Explain here how to use that facility.

\section{\packagename{linear} for Linear Algebra}

Todo: create instances for linear's type classes, recognizing that they require the nasty Functor orphan instance.

\section{\packagename{parsec} for Unit and Quantity Parsing}
\section{\packagename{time} for Times and Dates}

Users of the \packagename{time} package can find functions and lenses for converting
between the \typename{DiffTime} representation and \thispackage{}'s \typename{Time} representation in the
\submodule{Time} module of the \experimentalpackage{} package.

\section{\packagename{vector} for Boxed and Unboxed Arrays}

The \thispackage{} package provides instances of the \typename{Vector} and \typename{MVector} data families and the \classname{Unbox} class
allowing \typename{Quantity}s to be stored in unboxed vectors for improved performance and reduced storage overhead.

\section{\packagename{vector-space} for Linear Algebra}

Users of the \packagename{vector-space} package can find appropriate instances of
the \classname{AdditiveGroup} and \classname{VectorSpace} classes, along with an
instance of \classname{InnerSpace} for dimensionless quantities, in the
\submodule{VectorSpace} module of the \experimentalpackage{} package.

\chapter{Libraries Using \thispackage}

\section{\packagename{atmos} for Modeling Earth's Atmosphere}

The \packagename{atmos} package provides a dimensionally-typed implementation of the 1976 International Standard
Atmosphere, a model of how pressure, temperature, the speed of sound, and related quantities vary with
altitude in the Earth's atmosphere.

\section{\packagename{igrf} for Modeling Earth's Magnetic Field}

The \packagename{igrf} package provides a dimensionally-typed implementation of the International Geomagnetic
Reference Field, including parsing of model text files in the format released by the International Association of
Geomagnetism and Aeronomy and the United States National Oceanographic and Atmospheric Administration. The
package also directly includes the model coeffecients for the most recent model releases.

\chapter{Included Dimensions and Units}

\chapter{Comparison with Other Libraries}

\section{quantities}
\section{units}
\section{uom-plugin}

\end{document}

